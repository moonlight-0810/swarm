<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwarmChemistry - Cloud Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            overflow-x: auto;
            image-rendering: pixelated;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 255, 198, 0.2) 0%, transparent 50%);
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            padding: 20px;
            border: 3px solid #00ff00;
            border-radius: 0;
            box-shadow: 
                0 0 0 3px #ff006e,
                0 0 0 6px #8338ec,
                0 0 20px rgba(0, 255, 0, 0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 
                2px 2px 0px #000000,
                4px 4px 0px #ff006e,
                6px 6px 0px #8338ec;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .header p {
            font-size: 1.1em;
            color: #ffffff;
            text-shadow: 1px 1px 0px #000000;
            font-weight: 600;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 650px 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .canvas-section {
            background: #1a1a1a;
            border: 4px solid #00ff00;
            padding: 25px;
            box-shadow: 
                0 0 0 4px #ff006e,
                0 0 0 8px #8338ec,
                0 0 30px rgba(0, 255, 0, 0.3);
            position: relative;
        }
        
        .canvas-section::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            z-index: -1;
            border-radius: 0;
        }
        
        .controls-section {
            background: #1a1a1a;
            border: 4px solid #ff006e;
            padding: 25px;
            box-shadow: 
                0 0 0 4px #00ff00,
                0 0 0 8px #8338ec,
                0 0 30px rgba(255, 0, 110, 0.3);
            height: 750px;
            overflow-y: auto;
            position: relative;
        }
        
        .controls-section::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(135deg, #8338ec, #3a86ff, #06ffa5, #ff006e);
            z-index: -1;
        }
        
        canvas {
            border: 4px solid #06ffa5;
            background: #000;
            display: block;
            margin: 0 auto;
            box-shadow: 
                0 0 0 4px #3a86ff,
                0 0 20px rgba(6, 255, 165, 0.5),
                inset 0 0 50px rgba(6, 255, 165, 0.1);
            image-rendering: pixelated;
        }
        
        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #8338ec;
            position: relative;
        }
        
        .control-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .control-group::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            animation: gradientShift 2s ease infinite;
        }
        
        .control-group h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #06ffa5;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px #000000;
        }
        
        /* ÂΩ©Ëâ≤ÊåâÈíÆÊ†∑Âºè */
        button {
            border: 3px solid;
            color: #000000;
            padding: 12px 20px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            text-shadow: none;
        }
        
        /* ÈªòËÆ§ÊåâÈíÆ - ÁªøËâ≤ */
        button {
            background: #06ffa5;
            border-color: #00ff00;
            box-shadow: 
                0 4px 0 #00cc82,
                0 8px 15px rgba(6, 255, 165, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 0 #00cc82,
                0 12px 20px rgba(6, 255, 165, 0.6);
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 
                0 2px 0 #00cc82,
                0 4px 10px rgba(6, 255, 165, 0.4);
        }
        
        /* CanvasÊéßÂà∂ÊåâÈíÆ - ‰∏çÂêåÈ¢úËâ≤ */
        .canvas-controls button:nth-child(1) {
            background: #ff006e;
            border-color: #ff1744;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #cc0055,
                0 8px 15px rgba(255, 0, 110, 0.4);
        }
        
        .canvas-controls button:nth-child(1):hover {
            box-shadow: 
                0 6px 0 #cc0055,
                0 12px 20px rgba(255, 0, 110, 0.6);
        }
        
        .canvas-controls button:nth-child(2) {
            background: #ffbe0b;
            border-color: #ffc107;
            color: #000000;
            box-shadow: 
                0 4px 0 #cc9808,
                0 8px 15px rgba(255, 190, 11, 0.4);
        }
        
        .canvas-controls button:nth-child(2):hover {
            box-shadow: 
                0 6px 0 #cc9808,
                0 12px 20px rgba(255, 190, 11, 0.6);
        }
        
        .canvas-controls button:nth-child(3) {
            background: #8338ec;
            border-color: #9c4dff;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #662dbc,
                0 8px 15px rgba(131, 56, 236, 0.4);
        }
        
        .canvas-controls button:nth-child(3):hover {
            box-shadow: 
                0 6px 0 #662dbc,
                0 12px 20px rgba(131, 56, 236, 0.6);
        }
        
        .canvas-controls button:nth-child(4) {
            background: #3a86ff;
            border-color: #4dabf7;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #2e6bcc,
                0 8px 15px rgba(58, 134, 255, 0.4);
        }
        
        .canvas-controls button:nth-child(4):hover {
            box-shadow: 
                0 6px 0 #2e6bcc,
                0 12px 20px rgba(58, 134, 255, 0.6);
        }
        
        /* È¢ÑËÆæÊåâÈíÆÁΩëÊ†º */
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .preset-buttons button:nth-child(odd) {
            background: #ff006e;
            border-color: #ff1744;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #cc0055,
                0 8px 15px rgba(255, 0, 110, 0.4);
        }
        
        .preset-buttons button:nth-child(even) {
            background: #8338ec;
            border-color: #9c4dff;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #662dbc,
                0 8px 15px rgba(131, 56, 236, 0.4);
        }
        
        .preset-buttons button:nth-child(3n) {
            background: #3a86ff;
            border-color: #4dabf7;
            color: #ffffff;
            box-shadow: 
                0 4px 0 #2e6bcc,
                0 8px 15px rgba(58, 134, 255, 0.4);
        }
        
        .preset-buttons button:nth-child(4n) {
            background: #06ffa5;
            border-color: #00ff00;
            color: #000000;
            box-shadow: 
                0 4px 0 #00cc82,
                0 8px 15px rgba(6, 255, 165, 0.4);
        }
        
        .preset-buttons button:nth-child(5n) {
            background: #ffbe0b;
            border-color: #ffc107;
            color: #000000;
            box-shadow: 
                0 4px 0 #cc9808,
                0 8px 15px rgba(255, 190, 11, 0.4);
        }
        
        /* ÂêåÊ≠•ÊåâÈíÆÁâπÊÆäÊ†∑Âºè */
        .sync-button {
            background: linear-gradient(45deg, #ff006e, #8338ec) !important;
            border-color: #00ff00 !important;
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            padding: 15px 30px !important;
            animation: pulse 2s ease-in-out infinite !important;
            box-shadow: 
                0 4px 0 #662dbc,
                0 8px 20px rgba(255, 0, 110, 0.6) !important;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .sync-button:hover {
            animation: none !important;
            transform: translateY(-3px) !important;
            box-shadow: 
                0 7px 0 #662dbc,
                0 15px 25px rgba(255, 0, 110, 0.8) !important;
        }
        
        .population-display {
            background: #000000;
            border: 3px solid #00ff00;
            padding: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            max-height: 250px;
            overflow-y: auto;
            margin-top: 10px;
            white-space: pre-line;
            line-height: 1.4;
            color: #00ff00;
            box-shadow: 
                0 0 0 3px #ff006e,
                inset 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        /* Áä∂ÊÄÅÊ∂àÊÅØÊ†∑Âºè */
        .sync-status, .parse-status {
            margin-top: 15px;
            padding: 12px;
            border: 3px solid;
            font-size: 14px;
            text-align: center;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .sync-status.success, .parse-status.success {
            background: #000000;
            border-color: #00ff00;
            color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }
        
        .sync-status.error, .parse-status.error {
            background: #000000;
            border-color: #ff006e;
            color: #ff006e;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.5);
        }
        
        .sync-status.info, .parse-status.info {
            background: #000000;
            border-color: #3a86ff;
            color: #3a86ff;
            box-shadow: 0 0 20px rgba(58, 134, 255, 0.5);
        }
        
        /* ÂèÇÊï∞ËæìÂÖ•Ê†∑Âºè */
        .parameter-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            margin-bottom: 15px;
            background: #000000;
            border: 3px solid #8338ec;
            color: #00ff00;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
            box-shadow: 
                0 0 0 3px #ff006e,
                inset 0 0 20px rgba(131, 56, 236, 0.1);
        }
        
        .parameter-input::placeholder {
            color: #666666;
        }
        
        .parameter-input:focus {
            outline: none;
            border-color: #00ff00;
            box-shadow: 
                0 0 0 3px #ff006e,
                0 0 30px rgba(0, 255, 0, 0.5),
                inset 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .parameter-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .parameter-controls button:nth-child(1) {
            background: #06ffa5;
            border-color: #00ff00;
            color: #000000;
        }
        
        .parameter-controls button:nth-child(2) {
            background: #ff006e;
            border-color: #ff1744;
            color: #ffffff;
        }
        
        /* ÂèÇÊï∞Ë∞ÉËØïÂô®Ê†∑Âºè */
        .parameter-debugger {
            background: #000000;
            border: 3px solid #3a86ff;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 
                0 0 0 3px #06ffa5,
                inset 0 0 20px rgba(58, 134, 255, 0.1);
        }
        
        .population-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .population-selector label {
            font-weight: 700;
            color: #06ffa5;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0px #000000;
        }
        
        .population-selector select {
            background: #000000;
            border: 3px solid #8338ec;
            color: #00ff00;
            padding: 8px 12px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            min-width: 200px;
            box-shadow: 
                0 0 0 3px #ff006e,
                0 0 15px rgba(131, 56, 236, 0.3);
        }
        
        .population-selector select option {
            background: #000000;
            color: #00ff00;
        }
        
        .population-selector select:focus {
            outline: none;
            border-color: #00ff00;
            box-shadow: 
                0 0 0 3px #ff006e,
                0 0 25px rgba(0, 255, 0, 0.5);
        }
        
        .population-info {
            font-size: 12px;
            color: #8338ec;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .parameter-sliders {
            display: grid;
            gap: 15px;
        }
        
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            background: rgba(131, 56, 236, 0.1);
            border: 2px solid #8338ec;
        }
        
        .slider-group label {
            font-size: 13px;
            font-weight: 700;
            color: #06ffa5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
            height: 8px;
            background: #000000;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            border: 2px solid #ff006e;
            box-shadow: inset 0 0 10px rgba(255, 0, 110, 0.3);
        }
        
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff00;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 
                0 0 0 2px #000000,
                0 0 15px rgba(0, 255, 0, 0.8);
        }
        
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            background: #06ffa5;
            transform: scale(1.2);
        }
        
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #00ff00;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 
                0 0 0 2px #000000,
                0 0 15px rgba(0, 255, 0, 0.8);
        }
        
        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: #ffbe0b;
            font-weight: 700;
            min-width: 60px;
            text-align: right;
            text-shadow: 1px 1px 0px #000000;
        }
        
        .debugger-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #ff006e;
        }
        
        .debugger-controls button {
            background: #ffbe0b;
            border-color: #ffc107;
            color: #000000;
            padding: 12px 25px;
            font-size: 14px;
            font-weight: 700;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 550px 1fr;
                gap: 20px;
            }
            
            .controls-section {
                max-height: none;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
        }
        
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .controls-section {
                max-height: none;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .preset-buttons {
                grid-template-columns: 1fr;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
        }
        
        /* ÊªöÂä®Êù°Ê†∑Âºè */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #000000;
            border: 2px solid #8338ec;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ff006e;
            border: 2px solid #000000;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00ff00;
        }
        
        /* ÊñáÂ≠óÈÄâÊã©Ê†∑Âºè */
        ::selection {
            background: #ff006e;
            color: #ffffff;
        }
        
        /* ÂÉèÁ¥†ÂåñÊïàÊûú */
        .pixel-border {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        
        .livestream-wrapper {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 ÂÆΩÈ´òÊØî */
            margin-bottom: 15px;
            overflow: hidden;
            border: 3px solid #06ffa5;
            box-shadow: 
                0 0 0 3px #3a86ff,
                inset 0 0 20px rgba(6, 255, 165, 0.1);
        }
        
        .livestream-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background: #000000;
        }
        
        .livestream-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: opacity 0.3s ease;
        }
        
        .livestream-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .overlay-content {
            text-align: center;
            color: #00ff00;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .overlay-content h4 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #ff006e;
            text-shadow: 2px 2px 0px #000000;
        }
        
        .overlay-content p {
            font-size: 14px;
            margin-bottom: 20px;
            color: #06ffa5;
        }
        
        .play-livestream-btn {
            background: linear-gradient(45deg, #ff006e, #8338ec) !important;
            border: 3px solid #00ff00 !important;
            color: #ffffff !important;
            padding: 15px 25px !important;
            font-size: 16px !important;
            font-weight: 700 !important;
            border-radius: 0 !important;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .play-livestream-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 0 #662dbc,
                0 12px 20px rgba(255, 0, 110, 0.6);
            animation: none;
        }
        

        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SwarmChemistry</h1>
            <p>Cloud Edition - Create particle behaviors, sync to Unity</p>
        </div>
        
        <div class="main-layout">
            <div class="canvas-section">
                <canvas id="swarmCanvas" width="600" height="600"></canvas>
                <div class="canvas-controls">
                    <button onclick="startSimulation()">Start</button>
                    <button onclick="pauseSimulation()">Pause</button>
                    <button onclick="clearCanvas()">Clear</button>
                    <button onclick="resetView()">Reset View</button>
                </div>
            </div>
            
            <div class="controls-section">
                <div class="control-group">
                    <div class="youtube-livestream-container">
                        <div class="livestream-wrapper" id="livestreamWrapper">
                            <iframe 
                                id="youtubeFrame" 
                                src="https://www.youtube.com/embed/rC_JmB3uaPk?autoplay=0&mute=1&controls=1&showinfo=1&rel=0&modestbranding=1&cc_load_policy=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                allowfullscreen
                                title="YouTube Áõ¥Êí≠ËßÜÈ¢ë">
                            </iframe>
                            <div class="livestream-overlay" id="livestreamOverlay">
                                <div class="overlay-content">
                                    <button onclick="startLivestream()" class="play-livestream-btn">‚ñ∂Ô∏è Start</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <button class="sync-button" onclick="syncToUnity()">Sync to Unity</button>
                    <div id="syncStatus" class="sync-status" style="display: none;"></div>
                </div>
                
                <div class="control-group">
                    <h3>Custom Parameters</h3>
                    <textarea id="parameterInput" class="parameter-input" placeholder="Enter parameter format, example:
48 * (150.39, 15.89, 23.54, 0.74, 0.45, 62.65, 0.33, 0.13)
152 * (217.14, 12.13, 12.42, 0.59, 0.98, 14.06, 0.04, 0.65)
14 * (248.54, 5.85, 22.26, 0.43, 0.11, 17.14, 0.06, 0.68)
31 * (141.53, 2.91, 4.86, 0.92, 0.03, 21.87, 0.28, 0.2)"></textarea>
                    <div class="parameter-controls">
                        <button onclick="parseCustomParameters()">Parse Parameters</button>
                        <button onclick="clearParameters()">Clear Input</button>
                    </div>
                    <div id="parseStatus" class="parse-status" style="display: none;"></div>
                </div>
                
                <div class="control-group">
                    <h3>Parameter Debugger</h3>
                    <div class="parameter-debugger">
                        <div class="population-selector">
                            <label for="populationSelect">Select Population:</label>
                            <select id="populationSelect" onchange="selectPopulation()">
                                <option value="">Please select population...</option>
                            </select>
                            <span id="populationInfo" class="population-info"></span>
                        </div>
                        
                        <div id="parameterSliders" class="parameter-sliders" style="display: none;">
                            <!-- È¢úËâ≤È¢ÑËßàÂùó -->
                            <div class="color-preview-group" style="margin-bottom: 20px; padding: 15px; background: rgba(6, 255, 165, 0.1); border: 2px solid #06ffa5;">
                                <label style="font-size: 14px; font-weight: 700; color: #06ffa5; text-transform: uppercase; margin-bottom: 10px; display: block;">Color Preview:</label>
                                <div id="colorPreview" style="width: 100%; height: 40px; border: 3px solid #ffffff; background: #ff0000; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 700; color: #000000; text-shadow: 1px 1px 0px #ffffff;">
                                    RGB(255, 255, 255)
                                </div>
                            </div>
                            
                            <div class="slider-group">
                                <label>Neighborhood Radius:</label>
                                <input type="range" id="slider_neighborhoodRadius" min="10" max="400" step="0.1" oninput="updateParameter('neighborhoodRadius', this.value)">
                                <span id="value_neighborhoodRadius" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Normal Speed:</label>
                                <input type="range" id="slider_normalSpeed" min="0" max="25" step="0.01" oninput="updateParameter('normalSpeed', this.value)">
                                <span id="value_normalSpeed" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Max Speed:</label>
                                <input type="range" id="slider_maxSpeed" min="0" max="50" step="0.01" oninput="updateParameter('maxSpeed', this.value)">
                                <span id="value_maxSpeed" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Cohesion C1:</label>
                                <input type="range" id="slider_c1" min="0" max="1" step="0.01" oninput="updateParameter('c1', this.value)">
                                <span id="value_c1" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Alignment C2:</label>
                                <input type="range" id="slider_c2" min="0" max="1" step="0.01" oninput="updateParameter('c2', this.value)">
                                <span id="value_c2" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Separation C3:</label>
                                <input type="range" id="slider_c3" min="0" max="100" step="0.01" oninput="updateParameter('c3', this.value)">
                                <span id="value_c3" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Randomness C4:</label>
                                <input type="range" id="slider_c4" min="0" max="1" step="0.01" oninput="updateParameter('c4', this.value)">
                                <span id="value_c4" class="slider-value">0</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>Speed Control C5:</label>
                                <input type="range" id="slider_c5" min="0" max="1" step="0.01" oninput="updateParameter('c5', this.value)">
                                <span id="value_c5" class="slider-value">0</span>
                            </div>
                            
                            <div class="debugger-controls">
                                <button onclick="resetSelectedPopulation()">Reset Parameters</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Classic SwarmChemistry Presets (Group 1)</h3>
                    <div class="preset-buttons">
                        <button onclick="loadPreset('uzushio')">Uzushio</button>
                        <button onclick="loadPreset('insurmountable_wall')">Insurmountable Wall</button>
                        <button onclick="loadPreset('cell_with_two_nuclei')">Cell with Two Nuclei</button>
                        <button onclick="loadPreset('multicellularity')">Multicellularity</button>
                        <button onclick="loadPreset('jelly_fish')">Jelly Fish</button>
                        <button onclick="loadPreset('no_wait_this_way')">No, Wait - This Way</button>
                        <button onclick="loadPreset('recombining_blobs')">Recombining Blobs</button>
                        <button onclick="loadPreset('playing_catch')">Playing Catch</button>
                        <button onclick="loadPreset('pulsating_eye')">Pulsating Eye</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Classic SwarmChemistry Presets (Group 2)</h3>
                    <div class="preset-buttons">
                        <button onclick="loadPreset('chaos_cells')">Chaos Cells</button>
                        <button onclick="loadPreset('aggressive_predator')">Aggressive Predator</button>
                        <button onclick="loadPreset('fast_walker_slow_follower')">Fast Walker & Slow Follower</button>
                        <button onclick="loadPreset('swinger')">Swinger</button>
                        <button onclick="loadPreset('rotary')">Rotary</button>
                        <button onclick="loadPreset('wedding_ring')">Wedding Ring</button>
                        <button onclick="loadPreset('turbulent_runner')">Turbulent Runner</button>
                        <button onclick="loadPreset('blobs')">Blobs</button>
                        <button onclick="loadPreset('linear_oscillator')">Linear Oscillator</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Current Population</h3>
                    <div id="populationDisplay" class="population-display">
                        Click preset buttons to generate particle populations...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SwarmChemistry Cloud Edition - Algorithm implementation consistent with original Java version
        
        // Global variables
        let canvas, ctx;
        let individuals = [];
        let animationId;
        let isRunning = false;
        let mouseX = -1, mouseY = -1;
        let mouseInfluence = false;
        
        // ÂêåÊ≠•ÈÖçÁΩÆ - ‰ΩøÁî®ÂΩìÂâçÂüüÂêç
        const SYNC_CONFIG = {
            serverUrl: window.location.origin + '/api',
            enabled: true
        };
        
        // SwarmParametersÁ±ª - ‰∏éÂéüÂßãÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
        class SwarmParameters {
            constructor(neighborhoodRadius = 50, normalSpeed = 2, maxSpeed = 5, 
                        c1 = 0.5, c2 = 0.5, c3 = 10, c4 = 0.1, c5 = 0.5) {
                this.neighborhoodRadius = neighborhoodRadius;
                this.normalSpeed = normalSpeed;
                this.maxSpeed = maxSpeed;
                this.c1 = c1; // ËÅöÈõÜÂäõ
                this.c2 = c2; // ÂØπÈΩêÂäõ
                this.c3 = c3; // ÂàÜÁ¶ªÂäõ
                this.c4 = c4; // ÈöèÊú∫ÊÄß
                this.c5 = c5; // ÈÄüÂ∫¶Ë∞ÉËäÇ
            }
            
            // Ê†πÊçÆJavaÁâàÊú¨ÁöÑÈ¢úËâ≤ËÆ°ÁÆóËßÑÂàô
            getColor() {
                // Â¢ûÂº∫È¢úËâ≤ÂØπÊØîÂ∫¶ÂíåÂèØËßÅÂ∫¶
                const r = Math.floor((this.c1 / 1.0) * 255);  // ÁßªÈô§0.8Á≥ªÊï∞ÔºåÂ¢ûÂº∫‰∫ÆÂ∫¶
                const g = Math.floor((this.c2 / 1.0) * 255);  // ÁßªÈô§0.8Á≥ªÊï∞ÔºåÂ¢ûÂº∫‰∫ÆÂ∫¶
                const b = Math.floor((this.c3 / 100.0) * 255); // ÁßªÈô§0.8Á≥ªÊï∞ÔºåÂ¢ûÂº∫‰∫ÆÂ∫¶
                
                // Á°Æ‰øùÊúÄÂ∞è‰∫ÆÂ∫¶ÔºåÈÅøÂÖçÂÖ®ÈªëËâ≤
                const minBrightness = 50;
                const finalR = Math.max(r, minBrightness);
                const finalG = Math.max(g, minBrightness);
                const finalB = Math.max(b, minBrightness);
                
                return `rgb(${finalR}, ${finalG}, ${finalB})`;
            }
            
            clone() {
                return new SwarmParameters(
                    this.neighborhoodRadius, this.normalSpeed, this.maxSpeed,
                    this.c1, this.c2, this.c3, this.c4, this.c5
                );
            }
            
            toString() {
                return `(${this.neighborhoodRadius.toFixed(2)}, ${this.normalSpeed.toFixed(2)}, ${this.maxSpeed.toFixed(2)}, ${this.c1.toFixed(2)}, ${this.c2.toFixed(2)}, ${this.c3.toFixed(2)}, ${this.c4.toFixed(2)}, ${this.c5.toFixed(2)})`;
            }
        }
        
        // SwarmIndividualÁ±ª - ‰∏éÂéüÂßãÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
        class SwarmIndividual {
            constructor(x, y, dx = 0, dy = 0, parameters) {
                this.x = x;
                this.y = y;
                this.dx = dx;
                this.dy = dy;
                this.dx2 = dx; // Áî®‰∫éÈÄüÂ∫¶Ë∞ÉËäÇÁöÑ‰∏¥Êó∂ÂèòÈáè
                this.dy2 = dy;
                this.parameters = parameters;
            }
            
            // Âä†ÈÄüÂ∫¶ËÆ°ÁÆó
            accelerate(ax, ay, maxSpeed) {
                this.dx2 += ax;
                this.dy2 += ay;
                
                // ÈôêÂà∂ÊúÄÂ§ßÈÄüÂ∫¶
                const speed = Math.sqrt(this.dx2 * this.dx2 + this.dy2 * this.dy2);
                if (speed > maxSpeed) {
                    this.dx2 = (this.dx2 / speed) * maxSpeed;
                    this.dy2 = (this.dy2 / speed) * maxSpeed;
                }
            }
            
            // ÁßªÂä®
            move() {
                this.dx = this.dx2;
                this.dy = this.dy2;
                
                this.x += this.dx;
                this.y += this.dy;
            }
            
            // ËæπÁïåÂ§ÑÁêÜ
            wrapAround(width, height) {
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }
        }
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('swarmCanvas');
            ctx = canvas.getContext('2d');
            
            // ËÆæÁΩÆÈ´òDPIÊîØÊåÅ
            const dpr = window.devicePixelRatio || 1;
            const displayWidth = 600;
            const displayHeight = 600;
            
            canvas.width = displayWidth * dpr;
            canvas.height = displayHeight * dpr;
            canvas.style.width = displayWidth + 'px';
            canvas.style.height = displayHeight + 'px';
            ctx.scale(dpr, dpr);
            
            setupEventListeners();
            initializeSwarm();
            animate();
            
            console.log('üéÆ SwarmChemistry Cloud Edition initialized');
            console.log('üñºÔ∏è Canvas size: 600x600');
            console.log('üåê Server URL:', SYNC_CONFIG.serverUrl);
        });
        
        // ‰∫ã‰ª∂ÁõëÂê¨Âô®ËÆæÁΩÆ
        function setupEventListeners() {
            // Èº†Ê†á‰∫ã‰ª∂
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });
            
            canvas.addEventListener('mouseenter', () => {
                mouseInfluence = true;
            });
            
            canvas.addEventListener('mouseleave', () => {
                mouseInfluence = false;
            });
            
            // ÈîÆÁõò‰∫ã‰ª∂
            document.addEventListener('keydown', (e) => {
                if (e.key === ' ') {
                    e.preventDefault();
                    togglePlayPause();
                }
            });
        }
        
        // ÁßçÁæ§ÂàùÂßãÂåñ - ‰∏éÂéüÂßãÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
        function initializeSwarm() {
            individuals = [];
            
            // ÂàõÂª∫Â§ö‰∏™‰∏çÂêåÂèÇÊï∞ÁöÑÁßçÁæ§ - ‰ΩøÁî®ÂéüÂßãÈªòËÆ§ÂèÇÊï∞
            const populations = [
                { count: 49, params: new SwarmParameters(184.07, 12.64, 38.49, 0.67, 0.31, 63.78, 0.11, 0.21) },
                { count: 67, params: new SwarmParameters(177.92, 15.66, 11.05, 0.85, 0.41, 51.77, 0.09, 0.86) },
                { count: 58, params: new SwarmParameters(177.92, 15.66, 11.05, 0.85, 0.41, 51.77, 0.03, 0.86) },
                { count: 10, params: new SwarmParameters(298.48, 0.65, 19.27, 0.84, 0.11, 83.18, 0.24, 0.5) },
                { count: 37, params: new SwarmParameters(81.6, 18.34, 27.3, 0.94, 0.17, 3.41, 0.2, 0.9) },
                { count: 1, params: new SwarmParameters(274.4, 3.33, 7.42, 0.9, 0.19, 7.37, 0.43, 0.17) },
                { count: 12, params: new SwarmParameters(203.64, 3.33, 7.42, 0.9, 0.19, 7.37, 0.43, 0.17) }
            ];
            
            // ËÆ°ÁÆóÁîªÂ∏É‰∏≠ÂøÉÁÇπ - ÈÄÇÂ∫îÊñ∞Â∞∫ÂØ∏
            const centerX = 600 / 2;
            const centerY = 600 / 2;
            const spawnRadius = 80; // Á®çÂæÆÂ¢ûÂ§ßÁîüÊàêÂçäÂæÑ
            
            populations.forEach(pop => {
                for (let i = 0; i < pop.count; i++) {
                    // Âú®ÂúÜÂΩ¢Âå∫ÂüüÂÜÖÈöèÊú∫ÁîüÊàê‰ΩçÁΩÆ
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.random() * spawnRadius;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    const individual = new SwarmIndividual(
                        x, y,
                        (Math.random() - 0.5) * 2, // ÂàùÂßãÈÄüÂ∫¶
                        (Math.random() - 0.5) * 2,
                        pop.params.clone()
                    );
                    individuals.push(individual);
                }
            });
            
            updatePopulationDisplay();
        }
        
        // Ê†∏ÂøÉÁæ§‰ΩìË°å‰∏∫ÁÆóÊ≥ï - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
        function simulateSwarmBehavior() {
            const mouseAgent = mouseInfluence ? {
                x: mouseX,
                y: mouseY,
                dx: 0,
                dy: 0
            } : null;
            
            individuals.forEach(individual => {
                const neighbors = findNeighbors(individual, mouseAgent);
                const params = individual.parameters;
                
                let ax = 0, ay = 0;
                
                if (neighbors.length === 0) {
                    // Êó†ÈÇªÂ±ÖÊó∂ÈöèÊú∫ÁßªÂä® - ‰∏éJavaÁâàÊú¨‰∏ÄËá¥
                    ax = Math.random() - 0.5;
                    ay = Math.random() - 0.5;
                } else {
                    // ËÆ°ÁÆóÈÇªÂ±Ö‰∏≠ÂøÉÂíåÂπ≥ÂùáÈÄüÂ∫¶
                    let centerX = 0, centerY = 0;
                    let avgDx = 0, avgDy = 0;
                    
                    neighbors.forEach(neighbor => {
                        centerX += neighbor.x;
                        centerY += neighbor.y;
                        avgDx += neighbor.dx || 0;
                        avgDy += neighbor.dy || 0;
                    });
                    
                    centerX /= neighbors.length;
                    centerY /= neighbors.length;
                    avgDx /= neighbors.length;
                    avgDy /= neighbors.length;
                    
                    // c1: ËÅöÈõÜË°å‰∏∫ - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
                    ax += (centerX - individual.x) * params.c1;
                    ay += (centerY - individual.y) * params.c1;
                    
                    // c2: ÂØπÈΩêË°å‰∏∫ - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
                    ax += (avgDx - individual.dx) * params.c2;
                    ay += (avgDy - individual.dy) * params.c2;
                    
                    // c3: ÂàÜÁ¶ªË°å‰∏∫ - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
                    neighbors.forEach(neighbor => {
                        const dx = individual.x - neighbor.x;
                        const dy = individual.y - neighbor.y;
                        let distSq = dx * dx + dy * dy;
                        
                        if (distSq === 0) distSq = 0.001; // ‰∏éJavaÁâàÊú¨‰∏ÄËá¥ÁöÑÂ§ÑÁêÜ
                        ax += (dx / distSq) * params.c3;
                        ay += (dy / distSq) * params.c3;
                    });
                    
                    // c4: ÈöèÊú∫ÊÄß - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
                    if (Math.random() < params.c4) {
                        ax += Math.random() * 10 - 5;
                        ay += Math.random() * 10 - 5;
                    }
                }
                
                // ‰ΩøÁî®ÂéüÂßãÊúÄÂ§ßÈÄüÂ∫¶ÂèÇÊï∞
                individual.accelerate(ax, ay, params.maxSpeed);
                
                // c5: ÈÄüÂ∫¶Ë∞ÉËäÇ - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
                const currentSpeed = Math.sqrt(individual.dx2 * individual.dx2 + individual.dy2 * individual.dy2);
                if (currentSpeed === 0) {
                    // ÈÅøÂÖçÈô§Èõ∂ÈîôËØØ
                    individual.accelerate(0, 0, params.maxSpeed);
                } else {
                    const speedDiff = params.normalSpeed - currentSpeed;
                    individual.accelerate(
                        (individual.dx2 / currentSpeed) * speedDiff * params.c5,
                        (individual.dy2 / currentSpeed) * speedDiff * params.c5,
                        params.maxSpeed
                    );
                }
            });
        }
        
        // Êü•ÊâæÈÇªÂ±Ö - ‰∏éJavaÁâàÊú¨ÂÆåÂÖ®‰∏ÄËá¥
        function findNeighbors(individual, mouseAgent = null) {
            const neighbors = [];
            const radiusSq = individual.parameters.neighborhoodRadius * individual.parameters.neighborhoodRadius;
            
            // Êü•ÊâæÂÖ∂‰ªñ‰∏™‰ΩìÈÇªÂ±Ö
            individuals.forEach(other => {
                if (other !== individual) {
                    const dx = individual.x - other.x;
                    const dy = individual.y - other.y;
                    const distSq = dx * dx + dy * dy;
                    
                    if (distSq < radiusSq) {
                        neighbors.push(other);
                    }
                }
            });
            
            // Èº†Ê†áÂΩ±Âìç - ‰∏éJavaÁâàÊú¨‰∏ÄËá¥ÁöÑÊùÉÈáç
            if (mouseAgent) {
                const dx = individual.x - mouseAgent.x;
                const dy = individual.y - mouseAgent.y;
                const distSq = dx * dx + dy * dy;
                
                if (distSq < radiusSq) {
                    // JavaÁâàÊú¨‰ΩøÁî®weightOfMouseCursor = 20
                    for (let i = 0; i < 20; i++) {
                        neighbors.push(mouseAgent);
                    }
                }
            }
            
            return neighbors;
        }
        
        // Êõ¥Êñ∞
        function update() {
            if (!isRunning) return;
            
            simulateSwarmBehavior();
            
            individuals.forEach(individual => {
                individual.move();
                individual.wrapAround(600, 600); // ‰ΩøÁî®Âõ∫ÂÆöÁîªÂ∏ÉÂ∞∫ÂØ∏
            });
        }
        
        // Ê∏≤Êüì
        function render() {
            // ÂÆåÂÖ®Ê∏ÖÁ©∫ÁîªÂ∏É
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 600, 600); // ‰ΩøÁî®Âõ∫ÂÆöÁîªÂ∏ÉÂ∞∫ÂØ∏
            
            // ÁªòÂà∂‰∏™‰Ωì
            individuals.forEach(individual => {
                const color = individual.parameters.getColor();
                
                // ÁªòÂà∂‰∏™‰Ωì
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(individual.x, individual.y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // ÁªòÂà∂ÊñπÂêëÊåáÁ§∫
                const speed = Math.sqrt(individual.dx * individual.dx + individual.dy * individual.dy);
                if (speed > 0.05) {
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(individual.x, individual.y);
                    ctx.lineTo(
                        individual.x + (individual.dx / speed) * 6,
                        individual.y + (individual.dy / speed) * 6
                    );
                    ctx.stroke();
                }
            });
            
            // ÁªòÂà∂Èº†Ê†áÂΩ±ÂìçËåÉÂõ¥
            if (mouseInfluence && mouseX >= 0) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(mouseX, mouseY, 50, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // Â∏ßÁéáÊéßÂà∂ÂèòÈáè
        let targetFPS = 30; // ÂèØË∞ÉËäÇÁöÑÁõÆÊ†áÂ∏ßÁéá
        let lastFrameTime = 0;
        
        // Âä®ÁîªÂæ™ÁéØ
        function animate(currentTime = 0) {
            // Â∏ßÁéáÊéßÂà∂
            if (currentTime - lastFrameTime >= 1000 / targetFPS) {
                update();
                render();
                lastFrameTime = currentTime;
            }
            requestAnimationFrame(animate);
        }
        
        // ÂèÇÊï∞Ë∞ÉËØïÂô®Áõ∏ÂÖ≥ÂèòÈáè
        let currentPopulations = [];
        let selectedPopulationIndex = -1;
        let originalParameters = null;
        let selectedPopulationIndividuals = []; // Êñ∞Â¢ûÔºöÂ≠òÂÇ®ÈÄâ‰∏≠ÁßçÁæ§ÁöÑ‰∏™‰ΩìÂºïÁî®
        
        // ÁªüËÆ°ÂíåÊòæÁ§∫ÁßçÁæ§‰ø°ÊÅØ
        function updatePopulationDisplay() {
            const populationStats = new Map();
            
            individuals.forEach(individual => {
                const paramStr = individual.parameters.toString();
                if (populationStats.has(paramStr)) {
                    populationStats.set(paramStr, populationStats.get(paramStr) + 1);
                } else {
                    populationStats.set(paramStr, 1);
                }
            });
            
            let displayText = `Total population: ${populationStats.size}\n`;
            displayText += `Total particles: ${individuals.length}\n\n`;
            
            // ÊûÑÂª∫ÂèÇÊï∞ËæìÂÖ•Ê†èÁöÑÂêåÊ≠•ÊñáÊú¨
            let parameterText = '';
            
            // Êõ¥Êñ∞ÁßçÁæ§ÂàóË°®Áî®‰∫éË∞ÉËØïÂô®
            currentPopulations = [];
            
            let index = 1;
            populationStats.forEach((count, params) => {
                displayText += `Population ${index}: ${count} * ${params}\n`;
                parameterText += `${count} * ${params}\n`;
                
                // Ëß£ÊûêÂèÇÊï∞Áî®‰∫éË∞ÉËØïÂô®
                const match = params.match(/\(([^)]+)\)/);
                if (match) {
                    const paramValues = match[1].split(',').map(p => parseFloat(p.trim()));
                    currentPopulations.push({
                        index: index,
                        count: count,
                        paramString: params, // Ê∑ªÂä†ÂèÇÊï∞Â≠óÁ¨¶‰∏≤Áî®‰∫éÂåπÈÖç
                        parameters: {
                            neighborhoodRadius: paramValues[0],
                            normalSpeed: paramValues[1],
                            maxSpeed: paramValues[2],
                            c1: paramValues[3],
                            c2: paramValues[4],
                            c3: paramValues[5],
                            c4: paramValues[6],
                            c5: paramValues[7]
                        }
                    });
                }
                index++;
            });
            
            document.getElementById('populationDisplay').textContent = displayText;
            
            // ÂÆûÊó∂ÂêåÊ≠•Âà∞ÂèÇÊï∞ËæìÂÖ•Ê†èÔºà‰ªÖÂú®Êúâ‰∏™‰ΩìÊó∂Ôºâ
            const parameterInput = document.getElementById('parameterInput');
            if (parameterInput && individuals.length > 0) {
                parameterInput.value = parameterText.trim();
            }
            
            // Êõ¥Êñ∞Ë∞ÉËØïÂô®ÁöÑÁßçÁæ§ÈÄâÊã©Âô®
            updatePopulationSelector();
        }
        
        // Êõ¥Êñ∞ÁßçÁæ§ÈÄâÊã©Âô®
        function updatePopulationSelector() {
            const selector = document.getElementById('populationSelect');
            if (!selector) return;
            
            // Ê∏ÖÁ©∫Áé∞ÊúâÈÄâÈ°π
            selector.innerHTML = '<option value="">Please select population...</option>';
            
            // Ê∑ªÂä†ÁßçÁæ§ÈÄâÈ°π
            currentPopulations.forEach((pop, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Population ${pop.index} (${pop.count} particles)`;
                selector.appendChild(option);
            });
            
            // Â¶ÇÊûú‰πãÂâçÊúâÈÄâ‰∏≠ÁöÑÁßçÁæ§ÔºåÂ∞ùËØï‰øùÊåÅÈÄâ‰∏≠Áä∂ÊÄÅ
            if (selectedPopulationIndex >= 0 && selectedPopulationIndex < currentPopulations.length) {
                selector.value = selectedPopulationIndex;
            } else {
                selectedPopulationIndex = -1;
                selectedPopulationIndividuals = [];
                document.getElementById('parameterSliders').style.display = 'none';
            }
        }
        
        // ÈÄâÊã©ÁßçÁæ§
        function selectPopulation() {
            const selector = document.getElementById('populationSelect');
            const index = parseInt(selector.value);
            
            if (isNaN(index) || index < 0 || index >= currentPopulations.length) {
                selectedPopulationIndex = -1;
                selectedPopulationIndividuals = [];
                document.getElementById('parameterSliders').style.display = 'none';
                document.getElementById('populationInfo').textContent = '';
                return;
            }
            
            selectedPopulationIndex = index;
            const population = currentPopulations[index];
            originalParameters = { ...population.parameters };
            
            // ÊâæÂà∞Â±û‰∫éËØ•ÁßçÁæ§ÁöÑÊâÄÊúâ‰∏™‰Ωì
            selectedPopulationIndividuals = [];
            individuals.forEach(individual => {
                if (individual.parameters.toString() === population.paramString) {
                    selectedPopulationIndividuals.push(individual);
                }
            });
            
            // ÊòæÁ§∫ÁßçÁæ§‰ø°ÊÅØ
            document.getElementById('populationInfo').textContent = 
                `${selectedPopulationIndividuals.length} particles`;
            
            // Êõ¥Êñ∞ÊªëÂùóÂÄº
            updateSliders(population.parameters);
            
            // ÊòæÁ§∫ÊªëÂùóÂå∫Âüü
            document.getElementById('parameterSliders').style.display = 'block';
            
            // Êõ¥Êñ∞È¢úËâ≤È¢ÑËßà
            updateColorPreview();
            
            console.log(`üéØ Selected population ${population.index} with ${selectedPopulationIndividuals.length} particles`);
        }
        
        // Êõ¥Êñ∞ÊªëÂùóÊòæÁ§∫
        function updateSliders(params) {
            const paramNames = ['neighborhoodRadius', 'normalSpeed', 'maxSpeed', 'c1', 'c2', 'c3', 'c4', 'c5'];
            
            paramNames.forEach(name => {
                const slider = document.getElementById(`slider_${name}`);
                const valueSpan = document.getElementById(`value_${name}`);
                
                if (slider && valueSpan) {
                    slider.value = params[name];
                    valueSpan.textContent = params[name].toFixed(2);
                }
            });
        }
        
        // Êõ¥Êñ∞Âçï‰∏™ÂèÇÊï∞
        function updateParameter(paramName, value) {
            if (selectedPopulationIndex < 0 || selectedPopulationIndividuals.length === 0) return;
            
            const numValue = parseFloat(value);
            const valueSpan = document.getElementById(`value_${paramName}`);
            if (valueSpan) {
                valueSpan.textContent = numValue.toFixed(2);
            }
            
            // Êõ¥Êñ∞ÂΩìÂâçÁßçÁæ§ÂèÇÊï∞
            currentPopulations[selectedPopulationIndex].parameters[paramName] = numValue;
            
            // Â¶ÇÊûúÊòØÈ¢úËâ≤Áõ∏ÂÖ≥ÂèÇÊï∞ÔºåÊòæÁ§∫È¢úËâ≤È¢ÑËßà
            if (['c1', 'c2', 'c3'].includes(paramName)) {
                const params = currentPopulations[selectedPopulationIndex].parameters;
                const previewColor = {
                    c1: params.c1,
                    c2: params.c2,
                    c3: params.c3,
                    getColor: function() {
                        const r = Math.floor((this.c1 / 1.0) * 255);
                        const g = Math.floor((this.c2 / 1.0) * 255);
                        const b = Math.floor((this.c3 / 100.0) * 255);
                        const minBrightness = 50;
                        const finalR = Math.max(r, minBrightness);
                        const finalG = Math.max(g, minBrightness);
                        const finalB = Math.max(b, minBrightness);
                        return `rgb(${finalR}, ${finalG}, ${finalB})`;
                    }
                };
                console.log(`üé® Color parameter ${paramName} changed to ${numValue.toFixed(2)}`);
                console.log(`üé® Preview color: ${previewColor.getColor()}`);
            }
            
            // ÂÆûÊó∂Â∫îÁî®Âà∞‰∏™‰Ωì
            applyParameterChanges();
            
            // Êõ¥Êñ∞È¢úËâ≤È¢ÑËßà
            updateColorPreview();
        }
        
        // Â∫îÁî®ÂèÇÊï∞Êõ¥Êîπ
        function applyParameterChanges() {
            if (selectedPopulationIndex < 0 || selectedPopulationIndividuals.length === 0) return;
            
            const targetParams = currentPopulations[selectedPopulationIndex].parameters;
            
            // Áõ¥Êé•Êõ¥Êñ∞ÈÄâ‰∏≠ÁßçÁæ§ÁöÑÊâÄÊúâ‰∏™‰Ωì
            selectedPopulationIndividuals.forEach(individual => {
                individual.parameters.neighborhoodRadius = targetParams.neighborhoodRadius;
                individual.parameters.normalSpeed = targetParams.normalSpeed;
                individual.parameters.maxSpeed = targetParams.maxSpeed;
                individual.parameters.c1 = targetParams.c1;
                individual.parameters.c2 = targetParams.c2;
                individual.parameters.c3 = targetParams.c3;
                individual.parameters.c4 = targetParams.c4;
                individual.parameters.c5 = targetParams.c5;
                
                // Âº∫Âà∂Ê∏ÖÈô§‰ªª‰ΩïÂèØËÉΩÁöÑÈ¢úËâ≤ÁºìÂ≠ò
                if (individual.parameters._cachedColor) {
                    delete individual.parameters._cachedColor;
                }
            });
            
            // Êõ¥Êñ∞ÊòæÁ§∫Ôºà‰ΩÜ‰∏çÈáçÊñ∞ÊûÑÂª∫ÁßçÁæ§ÂàóË°®ÔºåÈÅøÂÖçÂæ™ÁéØÔºâ
            updateParameterInputOnly();
            
            // Ê∑ªÂä†È¢úËâ≤Ë∞ÉËØï‰ø°ÊÅØ
            if (selectedPopulationIndividuals.length > 0) {
                const sampleColor = selectedPopulationIndividuals[0].parameters.getColor();
                console.log(`üé® Color updated for ${selectedPopulationIndividuals.length} particles`);
                console.log(`üé® New color: ${sampleColor} (c1=${targetParams.c1.toFixed(2)}, c2=${targetParams.c2.toFixed(2)}, c3=${targetParams.c3.toFixed(2)})`);
            }
            
            console.log(`üîß Applied parameter changes to ${selectedPopulationIndividuals.length} particles`);
        }
        
        // ‰ªÖÊõ¥Êñ∞ÂèÇÊï∞ËæìÂÖ•Ê°ÜÔºå‰∏çÈáçÂª∫ÁßçÁæ§ÂàóË°®
        function updateParameterInputOnly() {
            const populationStats = new Map();
            
            individuals.forEach(individual => {
                const paramStr = individual.parameters.toString();
                if (populationStats.has(paramStr)) {
                    populationStats.set(paramStr, populationStats.get(paramStr) + 1);
                } else {
                    populationStats.set(paramStr, 1);
                }
            });
            
            let displayText = `Total population: ${populationStats.size}\n`;
            displayText += `Total particles: ${individuals.length}\n\n`;
            
            // ÊûÑÂª∫ÂèÇÊï∞ËæìÂÖ•Ê†èÁöÑÂêåÊ≠•ÊñáÊú¨
            let parameterText = '';
            
            let index = 1;
            populationStats.forEach((count, params) => {
                displayText += `Population ${index}: ${count} * ${params}\n`;
                parameterText += `${count} * ${params}\n`;
                index++;
            });
            
            document.getElementById('populationDisplay').textContent = displayText;
            
            // ÂÆûÊó∂ÂêåÊ≠•Âà∞ÂèÇÊï∞ËæìÂÖ•Ê†è
            const parameterInput = document.getElementById('parameterInput');
            if (parameterInput && individuals.length > 0) {
                parameterInput.value = parameterText.trim();
            }
        }
        
        // ÈáçÁΩÆÈÄâ‰∏≠ÁßçÁæ§ÂèÇÊï∞
        function resetSelectedPopulation() {
            if (selectedPopulationIndex < 0 || !originalParameters || selectedPopulationIndividuals.length === 0) return;
            
            // ÊÅ¢Â§çÂéüÂßãÂèÇÊï∞
            currentPopulations[selectedPopulationIndex].parameters = { ...originalParameters };
            
            // Êõ¥Êñ∞ÊªëÂùóÊòæÁ§∫
            updateSliders(originalParameters);
            
            // Â∫îÁî®Êõ¥Êîπ
            applyParameterChanges();
            
            // Êõ¥Êñ∞È¢úËâ≤È¢ÑËßà
            updateColorPreview();
            
            console.log(`üîÑ Reset parameters for ${selectedPopulationIndividuals.length} particles`);
        }
        
        // È¢ÑËÆæÈÖçÁΩÆ - ÁªèÂÖ∏SwarmChemistryÈ¢ÑËÆæ
        const presets = {
            uzushio: [
                { count: 49, params: [184.07, 12.64, 38.49, 0.67, 0.31, 63.78, 0.11, 0.21] },
                { count: 67, params: [177.92, 15.66, 11.05, 0.85, 0.41, 51.77, 0.09, 0.86] },
                { count: 58, params: [177.92, 15.66, 11.05, 0.85, 0.41, 51.77, 0.03, 0.86] },
                { count: 10, params: [298.48, 0.65, 19.27, 0.84, 0.11, 83.18, 0.24, 0.5] },
                { count: 37, params: [81.6, 18.34, 27.3, 0.94, 0.17, 3.41, 0.2, 0.9] },
                { count: 1, params: [274.4, 3.33, 7.42, 0.9, 0.19, 7.37, 0.43, 0.17] },
                { count: 12, params: [203.64, 3.33, 7.42, 0.9, 0.19, 7.37, 0.43, 0.17] }
            ],
            insurmountable_wall: [
                { count: 42, params: [52.57, 9.91, 20.42, 0.32, 0.76, 1.8, 0.01, 0.64] },
                { count: 25, params: [84.87, 8.82, 24.98, 0.91, 0.44, 40.97, 0.18, 0.6] },
                { count: 45, params: [220.42, 4.65, 7.53, 0.96, 0.35, 46.18, 0.25, 1.0] },
                { count: 49, params: [279.64, 10.29, 35.95, 0.37, 0.49, 38.09, 0.32, 0.89] }
            ],
            cell_with_two_nuclei: [
                { count: 41, params: [249.84, 4.85, 28.73, 0.34, 0.45, 14.44, 0.09, 0.82] },
                { count: 26, params: [277.87, 15.02, 35.48, 0.68, 0.05, 82.96, 0.46, 0.9] },
                { count: 30, params: [277.87, 15.02, 24.44, 0.68, 0.05, 82.96, 0.43, 0.9] },
                { count: 28, params: [110.8, 16.12, 38.6, 0.18, 0.34, 14.3, 0.01, 0.01] },
                { count: 48, params: [83.79, 13.29, 7.54, 0.08, 0.79, 1.07, 0.15, 0.45] },
                { count: 74, params: [269.64, 6.62, 34.69, 0.36, 0.5, 30.2, 0.03, 0.23] }
            ],
            multicellularity: [
                { count: 99, params: [19.8, 15.73, 2.61, 0.85, 0.64, 10.51, 0.17, 0.06] },
                { count: 48, params: [300.0, 14.63, 0.0, 0.48, 0.81, 90.27, 0.25, 0.78] },
                { count: 37, params: [275.18, 16.9, 7.05, 0.48, 0.81, 90.27, 0.17, 0.85] },
                { count: 8, params: [159.59, 2.09, 24.19, 0.96, 0.59, 76.03, 0.01, 0.07] },
                { count: 42, params: [73.07, 1.82, 2.36, 0.27, 0.61, 40.55, 0.22, 0.86] }
            ],
            jelly_fish: [
                { count: 134, params: [262.65, 12.01, 25.87, 0.97, 1.0, 56.35, 0.26, 0.61] },
                { count: 67, params: [288.17, 6.19, 23.37, 0.95, 1.0, 1.31, 0.1, 0.9] },
                { count: 68, params: [150.5, 12.97, 15.87, 0.46, 0.39, 57.95, 0.17, 0.48] }
            ],
            no_wait_this_way: [
                { count: 60, params: [262.68, 2.82, 38.32, 0.21, 0.01, 54.93, 0.11, 0.19] },
                { count: 40, params: [78.58, 5.7, 33.23, 0.89, 0.18, 45.44, 0.04, 0.05] },
                { count: 40, params: [257.27, 14.96, 35.66, 0.2, 0.8, 47.81, 0.13, 0.13] }
            ],
            recombining_blobs: [
                { count: 132, params: [45.91, 10.82, 21.11, 0.86, 0.13, 42.48, 0.32, 0.74] },
                { count: 84, params: [113.26, 3.41, 25.71, 0.4, 0.39, 49.53, 0.13, 0.24] }
            ],
            playing_catch: [
                { count: 76, params: [84.06, 0.09, 9.89, 0.33, 0.32, 15.66, 0.22, 0.68] },
                { count: 100, params: [158.86, 18.4, 24.98, 0.3, 0.3, 1.72, 0.06, 0.37] }
            ],
            pulsating_eye: [
                { count: 102, params: [293.86, 17.06, 38.3, 0.81, 0.05, 0.83, 0.2, 0.9] },
                { count: 124, params: [226.18, 19.27, 24.57, 0.95, 0.84, 13.09, 0.07, 0.8] },
                { count: 74, params: [49.98, 8.44, 4.39, 0.92, 0.14, 96.92, 0.13, 0.51] }
            ],
            chaos_cells: [
                { count: 144, params: [109.03, 6.71, 12.7, 0.47, 0.6, 61.43, 0.02, 0.21] },
                { count: 89, params: [117.15, 16.33, 31.88, 0.39, 0.13, 12.96, 0.48, 0.8] },
                { count: 67, params: [76.3, 8.59, 26.57, 0.7, 0.64, 28.39, 0.3, 0.35] }
            ],
            aggressive_predator: [
                { count: 18, params: [211.92, 12.59, 19.37, 0.09, 0.21, 57.92, 0.0, 0.95] },
                { count: 41, params: [257.27, 14.96, 35.66, 0.2, 0.8, 47.81, 0.13, 0.13] },
                { count: 35, params: [262.68, 2.82, 38.32, 0.21, 0.01, 54.93, 0.11, 0.19] },
                { count: 31, params: [78.58, 5.7, 33.23, 0.89, 0.18, 45.44, 0.04, 0.05] },
                { count: 7, params: [194.21, 12.88, 21.68, 0.97, 0.19, 99.21, 0.5, 0.13] }
            ],
            fast_walker_slow_follower: [
                { count: 67, params: [216.35, 11.75, 7.7, 0.83, 0.97, 97.31, 0.02, 0.38] },
                { count: 29, params: [254.64, 7.28, 7.0, 0.95, 0.11, 22.41, 0.43, 0.31] },
                { count: 13, params: [105.4, 3.55, 5.24, 0.34, 0.18, 23.53, 0.39, 0.24] }
            ],
            swinger: [
                { count: 48, params: [150.39, 15.89, 23.54, 0.74, 0.45, 62.65, 0.33, 0.13] },
                { count: 152, params: [217.14, 12.13, 12.42, 0.59, 0.98, 14.06, 0.04, 0.65] },
                { count: 14, params: [248.54, 5.85, 22.26, 0.43, 0.11, 17.14, 0.06, 0.68] },
                { count: 31, params: [141.53, 2.91, 4.86, 0.92, 0.03, 21.87, 0.28, 0.2] }
            ],
            rotary: [
                { count: 29, params: [122.13, 19.19, 17.98, 0.65, 0.44, 19.88, 0.46, 0.2] },
                { count: 51, params: [299.13, 0.79, 38.71, 0.25, 0.18, 86.49, 0.38, 0.43] },
                { count: 10, params: [252.92, 19.99, 10.21, 0.23, 0.17, 1.22, 0.28, 0.92] }
            ],
            wedding_ring: [
                { count: 24, params: [220.51, 13.88, 3.47, 0.46, 0.38, 6.23, 0.19, 0.68] },
                { count: 13, params: [64.07, 1.4, 19.7, 0.88, 0.27, 0.36, 0.47, 0.72] },
                { count: 35, params: [117.53, 7.31, 21.72, 0.3, 0.5, 98.69, 0.03, 0.29] }
            ],
            turbulent_runner: [
                { count: 131, params: [177.1, 9.71, 30.06, 0.8, 0.43, 19.65, 0.45, 0.91] },
                { count: 169, params: [277.3, 14.67, 37.71, 0.68, 0.23, 77.01, 0.02, 0.31] }
            ],
            blobs: [
                { count: 300, params: [20.8, 1.95, 20.75, 0.95, 0.99, 9.31, 0.05, 0.68] }
            ],
            linear_oscillator: [
                { count: 133, params: [214.41, 17.93, 35.14, 0.64, 0.13, 0.29, 0.08, 0.97] },
                { count: 24, params: [253.6, 7.19, 15.51, 0.82, 0.33, 32.65, 0.34, 0.56] }
            ]
        };
        
        // Âä†ËΩΩÈ¢ÑËÆæ
        function loadPreset(presetName) {
            if (!presets[presetName]) {
                console.error('Êú™ÊâæÂà∞È¢ÑËÆæ:', presetName);
                return;
            }
            
            individuals = [];
            const presetData = presets[presetName];
            
            // ËÆ°ÁÆóÁîªÂ∏É‰∏≠ÂøÉÁÇπ - ÈÄÇÂ∫îÊñ∞Â∞∫ÂØ∏
            const centerX = 600 / 2;
            const centerY = 600 / 2;
            const spawnRadius = 80;
            
            presetData.forEach((pop, index) => {
                const params = new SwarmParameters(
                    pop.params[0], pop.params[1], pop.params[2],
                    pop.params[3], pop.params[4], pop.params[5],
                    pop.params[6], pop.params[7]
                );
                
                // ÁîüÊàê‰∏™‰Ωì
                for (let i = 0; i < pop.count; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.random() * spawnRadius;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    individuals.push(new SwarmIndividual(
                        x, y,
                        (Math.random() - 0.5) * 2,
                        (Math.random() - 0.5) * 2,
                        params
                    ));
                }
            });
            
            updatePopulationDisplay();
            
            if (!isRunning) {
                startSimulation();
            }
            
            console.log(`üéØ Loaded preset: ${presetName}, Total particles: ${individuals.length}`);
        }
        
        // ÊéßÂà∂ÂáΩÊï∞
        function startSimulation() {
            isRunning = true;
        }
        
        function pauseSimulation() {
            isRunning = false;
        }
        
        function clearCanvas() {
            pauseSimulation();
            individuals = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            updatePopulationDisplay();
        }
        
        function resetView() {
            initializeSwarm();
        }
        
        function togglePlayPause() {
            if (isRunning) {
                pauseSimulation();
            } else {
                startSimulation();
            }
        }
        
        // Ëß£ÊûêËá™ÂÆö‰πâÂèÇÊï∞
        function parseCustomParameters() {
            const input = document.getElementById('parameterInput').value.trim();
            
            if (!input) {
                showParseStatus('Please enter parameters! / ËØ∑ËæìÂÖ•ÂèÇÊï∞ÔºÅ', 'error');
                return;
            }
            
            showParseStatus('üîç Parsing parameters... / Ê≠£Âú®Ëß£ÊûêÂèÇÊï∞...', 'info');
            
            try {
                const lines = input.split('\n').filter(line => line.trim());
                individuals = [];
                let totalParsed = 0;
                
                // ËÆ°ÁÆóÁîªÂ∏É‰∏≠ÂøÉÁÇπ
                const centerX = 600 / 2;
                const centerY = 600 / 2;
                const spawnRadius = 80;
                
                lines.forEach((line, index) => {
                    // ÂåπÈÖçÊ†ºÂºè: count * (param1, param2, param3, param4, param5, param6, param7, param8)
                    const match = line.trim().match(/(\d+)\s*\*\s*\(([^)]+)\)/);
                    
                    if (match) {
                        const count = parseInt(match[1]);
                        const params = match[2].split(',').map(p => parseFloat(p.trim()));
                        
                        if (params.length === 8 && params.every(p => !isNaN(p))) {
                            const swarmParams = new SwarmParameters(
                                params[0], params[1], params[2],
                                params[3], params[4], params[5],
                                params[6], params[7]
                            );
                            
                            // ÁîüÊàê‰∏™‰Ωì
                            for (let i = 0; i < count; i++) {
                                const angle = Math.random() * 2 * Math.PI;
                                const radius = Math.random() * spawnRadius;
                                
                                const x = centerX + Math.cos(angle) * radius;
                                const y = centerY + Math.sin(angle) * radius;
                                
                                individuals.push(new SwarmIndividual(
                                    x, y,
                                    (Math.random() - 0.5) * 2,
                                    (Math.random() - 0.5) * 2,
                                    swarmParams
                                ));
                            }
                            
                            totalParsed += count;
                        } else {
                            throw new Error(`Line ${index + 1} parameter format error: requires 8 numeric parameters / Á¨¨ ${index + 1} Ë°åÂèÇÊï∞Ê†ºÂºèÈîôËØØÔºöÈúÄË¶Å8‰∏™Êï∞ÂÄºÂèÇÊï∞`);
                        }
                    } else {
                        throw new Error(`Line ${index + 1} format error: should be "count * (param1, param2, ...param8)" / Á¨¨ ${index + 1} Ë°åÊ†ºÂºèÈîôËØØÔºöÂ∫î‰∏∫ "Êï∞Èáè * (ÂèÇÊï∞1, ÂèÇÊï∞2, ...ÂèÇÊï∞8)"`);
                    }
                });
                
                if (individuals.length === 0) {
                    throw new Error('No valid parameter lines found / Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑÂèÇÊï∞Ë°å');
                }
                
                updatePopulationDisplay();
                
                // Â¶ÇÊûúÊ≤°ÊúâËøêË°åÔºåÂºÄÂßãÊ®°Êãü
                if (!isRunning) {
                    startSimulation();
                }
                
                showParseStatus(`‚úÖ Parse successful! Created ${totalParsed} particles`, 'success');
                console.log(`üìù Custom parameters parsed successfully: ${totalParsed} particles`);
                
            } catch (error) {
                console.error('‚ùå Parameter parsing failed:', error);
                showParseStatus(`‚ùå Parse failed: ${error.message}`, 'error');
            }
        }
        
        // Ê∏ÖÁ©∫ÂèÇÊï∞ËæìÂÖ•
        function clearParameters() {
            document.getElementById('parameterInput').value = '';
            showParseStatus('Input cleared', 'info');
            setTimeout(() => {
                document.getElementById('parseStatus').style.display = 'none';
            }, 2000);
        }
        
        // ÊòæÁ§∫Ëß£ÊûêÁä∂ÊÄÅ
        function showParseStatus(message, type) {
            const statusDiv = document.getElementById('parseStatus');
            statusDiv.textContent = message;
            statusDiv.className = `parse-status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // ÂêåÊ≠•Âà∞Unity
        async function syncToUnity() {
            if (individuals.length === 0) {
                showSyncStatus('Please select a preset or input parameters first!', 'error');
                return;
            }
            
            showSyncStatus('üöÄ Syncing to Unity...', 'info');
            
            try {
                // Êî∂ÈõÜÁßçÁæ§Êï∞ÊçÆ
                const populationStats = new Map();
                
                individuals.forEach(individual => {
                    const paramStr = individual.parameters.toString();
                    if (populationStats.has(paramStr)) {
                        populationStats.set(paramStr, populationStats.get(paramStr) + 1);
                    } else {
                        populationStats.set(paramStr, 1);
                    }
                });
                
                const populations = [];
                populationStats.forEach((count, paramStr) => {
                    // ‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠Ëß£ÊûêÂèÇÊï∞
                    const match = paramStr.match(/\(([^)]+)\)/);
                    if (match) {
                        const params = match[1].split(',').map(p => parseFloat(p.trim()));
                        populations.push({
                            count: count,
                            parameters: {
                                neighborhoodRadius: params[0],
                                normalSpeed: params[1],
                                maxSpeed: params[2],
                                c1: params[3],
                                c2: params[4],
                                c3: params[5],
                                c4: params[6],
                                c5: params[7],
                                color: `rgb(${Math.floor((params[3] / 1.0) * 0.8 * 255)}, ${Math.floor((params[4] / 1.0) * 0.8 * 255)}, ${Math.floor((params[5] / 100.0) * 0.8 * 255)})`
                            }
                        });
                    }
                });
                
                const swarmData = {
                    sessionId: 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    timestamp: new Date().toISOString(),
                    populations: populations,
                    totalIndividuals: individuals.length,
                    userAgent: navigator.userAgent,
                    source: 'SwarmChemistry Web Cloud'
                };
                
                console.log('üì§ Sending data to server:', swarmData);
                
                const response = await fetch(SYNC_CONFIG.serverUrl + '/swarm-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(swarmData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSyncStatus(`‚úÖ Sync successful! Data ID: ${result.dataId}`, 'success');
                    console.log('‚úÖ Sync successful:', result);
                } else {
                    throw new Error(result.message || 'Sync failed');
                }
                
            } catch (error) {
                console.error('‚ùå Sync failed:', error);
                showSyncStatus(`‚ùå Sync failed: ${error.message}`, 'error');
            }
        }
        
        // ÊòæÁ§∫ÂêåÊ≠•Áä∂ÊÄÅ
        function showSyncStatus(message, type) {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.textContent = message;
            statusDiv.className = `sync-status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        console.log('üåê SwarmChemistry Cloud Edition loaded');
        console.log('üîó API endpoint:', SYNC_CONFIG.serverUrl);
        
        // Êõ¥Êñ∞È¢úËâ≤È¢ÑËßà
        function updateColorPreview() {
            if (selectedPopulationIndex < 0) return;
            
            const params = currentPopulations[selectedPopulationIndex].parameters;
            const colorPreview = document.getElementById('colorPreview');
            
            if (colorPreview) {
                // ËÆ°ÁÆóÈ¢úËâ≤
                const r = Math.floor((params.c1 / 1.0) * 255);
                const g = Math.floor((params.c2 / 1.0) * 255);
                const b = Math.floor((params.c3 / 100.0) * 255);
                const minBrightness = 50;
                const finalR = Math.max(r, minBrightness);
                const finalG = Math.max(g, minBrightness);
                const finalB = Math.max(b, minBrightness);
                
                const colorString = `rgb(${finalR}, ${finalG}, ${finalB})`;
                
                // Êõ¥Êñ∞È¢ÑËßàÂùó
                colorPreview.style.background = colorString;
                colorPreview.textContent = `RGB(${finalR}, ${finalG}, ${finalB})`;
                
                // Ê†πÊçÆËÉåÊôØ‰∫ÆÂ∫¶Ë∞ÉÊï¥ÊñáÂ≠óÈ¢úËâ≤
                const brightness = (finalR * 299 + finalG * 587 + finalB * 114) / 1000;
                colorPreview.style.color = brightness > 128 ? '#000000' : '#ffffff';
                colorPreview.style.textShadow = brightness > 128 ? '1px 1px 0px #ffffff' : '1px 1px 0px #000000';
            }
        }
        
        // YouTubeÁõ¥Êí≠ÊéßÂà∂ÂäüËÉΩ
        let isLivestreamPlaying = false;
        
        // ÂºÄÂßãËßÇÁúãÁõ¥Êí≠
        function startLivestream() {
            const overlay = document.getElementById('livestreamOverlay');
            
            overlay.classList.add('hidden');
            isLivestreamPlaying = true;
            
            console.log('üé• YouTubeÁõ¥Êí≠Â∑≤ÂºÄÂßã');
        }
        
        // Ê∑ªÂä†ÊªëÂÖ•ÊªëÂá∫Âä®Áîª
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 